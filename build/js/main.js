"use strict";

document.addEventListener("DOMContentLoaded", function () {
  var stageTabs = document.querySelectorAll(".predict__tabs-item"),
    stageWraps = document.querySelectorAll(".predict__stage"),
    loseCards = document.querySelectorAll(".predict__lose-card"),
    loseCardsTeams = document.querySelectorAll(".predict__lose-team"),
    winCards = document.querySelectorAll(".predict__win-card"),
    winCardsTeams = document.querySelectorAll(".predict__win-team"),
    predictOverlay = document.querySelector(".predict__overlay"),
    predictPopups = predictOverlay.querySelectorAll(".predict__teams"),
    predictTeams = predictOverlay.querySelectorAll(".predict__teams-item"),
    predictBtns = document.querySelectorAll(".cards-btn"),
    predictList = document.querySelectorAll(".predict__list"),
    predictListItem = document.querySelectorAll(".predict__list-item");

  // console.log(predictBtns)

  var currentCard;
  // let setStatus;

  function setPopup(overlay, btns, popups, btnWraps) {
    btns.forEach(function (btn, i) {
      btn.addEventListener("click", function (e) {
        var predictBtns = document.querySelectorAll(".cards-btn"),
          targetClick = true;
        // console.log(predictBtns)
        predictBtns.forEach(function (predictBtn) {
          var storageData = e.target.parentElement.getAttribute("data-storage");
          if (predictBtn === e.target && storageData !== null) {
            targetClick = false;
            e.target.parentElement.removeAttribute("data-storage");
          }
          return targetClick;
        });
        if (targetClick) {
          var index;
          btnWraps.forEach(function (wrap, i) {
            if (btn.parentElement === wrap) {
              return index = i;
            }
          });
          showPopup(popups, overlay, index);
          return currentCard = btn;
        }
      });
    });
  }
  setPopup(predictOverlay, predictListItem, predictPopups, predictList);
  function showPopup(popups, overlay, index) {
    popups.forEach(function (popup) {
      return popup.classList.remove("_active");
    });
    overlay.classList.add("_active");
    popups[index].classList.add("_active");
    document.body.style.overflow = "hidden";
    var closeBtn = popups[index].querySelector(".predict__teams-close");
    closeBtn.addEventListener("click", function () {
      overlay.classList.remove("_active");
      popups[index].classList.remove("_active");
      document.body.style.overflow = "auto";
    }, {
      once: true
    });
  }
  function setPopupWinLose(overlay, btns, popups, predictBtns) {
    btns.forEach(function (btn, index) {
      btn.addEventListener("click", function (e) {
        var targetClick = true;
        predictBtns.forEach(function (predictBtn) {
          if (predictBtn.classList === e.target.classList) {
            targetClick = false;
          }
          return targetClick;
        });
        if (targetClick) {
          showPopup(popups, overlay, index);
          return currentCard = btn;
        }
      });
    });
  }
  setPopupWinLose(predictOverlay, winCards, predictPopups, predictBtns);
  setPopupWinLose(predictOverlay, loseCards, predictPopups, predictBtns);
  function setTeam(teams, cardsText, overlay, popups, status) {
    if (status) {
      var cards = [];
      cardsText.forEach(function (item) {
        cards.push(item.parentElement.classList[1]);
      });
      cards.forEach(function (card, i) {
        var key = "selectedTeam-".concat(card, "-").concat(status);
        if (localStorage.getItem(key)) {
          cardsText[i].innerHTML = "\u041A\u043E\u043C\u0430\u043D\u0434\u0430 <br> ".concat(localStorage.getItem(key));
          cardsText[i].parentElement.parentElement.classList.remove("_select");
          if (cardsText[i].innerText.trim() !== '') {
            cardsText[i].parentElement.parentElement.classList.add("_select");
            cardsText[i].parentElement.parentElement.setAttribute('data-storage', key);
          }
        }
      });
      teams.forEach(function (team) {
        team.addEventListener("click", function (e) {
          // const teamParent = team.parentElement.parentElement;
          var teamName = team.querySelector(".team-name").textContent;
          cards.forEach(function (card, i) {
            if (currentCard === cardsText[i].parentElement) {
              var key = "selectedTeam-".concat(card, "-").concat(status);
              currentCard.parentElement.classList.add("_select");
              currentCard.parentElement.setAttribute('data-storage', key);
              localStorage.setItem(key, "".concat(teamName));
              cardsText[i].innerHTML = "\u041A\u043E\u043C\u0430\u043D\u0434\u0430 <br> ".concat(teamName);
              overlay.classList.remove("_active");
              popups.forEach(function (popup) {
                return popup.classList.remove("_active");
              });
              document.body.style.overflow = "auto";
            }
          });
        });
      });
    } else {
      var cardsTextLists = [];
      cardsText.forEach(function (item) {
        return cardsTextLists.push(item);
      });
      cardsTextLists.forEach(function (list, listIndex) {
        list.childNodes.forEach(function (item, i) {
          var stage = list.getAttribute("data-stage"),
            key = "selectedTeam-".concat(stage, "-card").concat(++i),
            teamTextBlock = item.querySelector(".".concat(item.classList[0], "-team"));
          teams.forEach(function (team) {
            team.addEventListener("click", function (e) {
              if (item === currentCard) {
                var teamName = team.querySelector(".team-name").textContent;
                currentCard.classList.add("_select");
                currentCard.setAttribute('data-storage', key);
                localStorage.setItem(key, "".concat(teamName));
                // console.log(item)
                teamTextBlock.innerHTML = "\u041A\u043E\u043C\u0430\u043D\u0434\u0430 <br> ".concat(teamName);
                overlay.classList.remove("_active");
                popups.forEach(function (popup) {
                  return popup.classList.remove("_active");
                });
                document.body.style.overflow = "auto";
              }
            });
          });
          if (localStorage.getItem(key)) {
            console.log("key");
            teamTextBlock.innerHTML = "\u041A\u043E\u043C\u0430\u043D\u0434\u0430 <br> ".concat(localStorage.getItem(key));
            teamTextBlock.parentElement.parentElement.classList.remove("_select");
            if (teamTextBlock.innerText.trim() !== '') {
              teamTextBlock.parentElement.classList.add("_select");
              teamTextBlock.parentElement.setAttribute('data-storage', key);
            }
          }
        });
      });
    }
  }
  setTeam(predictTeams, winCardsTeams, predictOverlay, predictPopups, "win");
  setTeam(predictTeams, loseCardsTeams, predictOverlay, predictPopups, "lose");
  setTeam(predictTeams, predictList, predictOverlay, predictPopups, null);
  function removeTeam(removeBtns, listState) {
    removeBtns.forEach(function (removeBtn) {
      removeBtn.addEventListener("click", function () {
        var btnParent = removeBtn.parentElement.parentElement,
          dataBtn = btnParent.getAttribute("data-storage");

        // console.log(dataBtn)
        if (!dataBtn) {
          btnParent = removeBtn.parentElement;
          dataBtn = btnParent.getAttribute("data-storage");
        }
        localStorage.removeItem(dataBtn);
        btnParent.classList.remove("_select");
      });
    });
  }

  // removeTeam(predictBtns)
  removeTeam(predictBtns);
  stageTabs.forEach(function (tab, tabIndex) {
    tab.addEventListener("click", function (e) {
      stageTabs.forEach(function (tab, i) {
        tab.classList.remove("_active");
      });
      stageWraps.forEach(function (item, stageIndex) {
        item.classList.remove("_active");
        if (tabIndex === stageIndex) {
          item.classList.add("_active");
          if (item.classList.contains("stage3")) {
            item.parentElement.classList.add('stage3');
          } else {
            item.parentElement.classList.remove('stage3');
          }
        }
      });
      e.target.classList.add("_active");
    });
  });

  // countdown timer
  function startCountdown(element) {
    var targetDate = new Date(element.getAttribute('data-target-date'));
    function updateCountdown() {
      var now = new Date(),
        difference = targetDate - now;
      if (difference <= 0) {
        element.querySelector('.predict__info-lock-countdown').textContent = "time over";
        clearInterval(countdownInterval);
        return;
      }
      var days = Math.floor(difference / (1000 * 60 * 60 * 24)),
        hours = Math.floor(difference % (1000 * 60 * 60 * 24) / (1000 * 60 * 60)),
        minutes = Math.floor(difference % (1000 * 60 * 60) / (1000 * 60));
      element.querySelector('.predict__info-lock-days').textContent = days;
      element.querySelector('.predict__info-lock-hours').textContent = hours;
      element.querySelector('.predict__info-lock-minutes').textContent = minutes;
    }
    var countdownInterval = setInterval(updateCountdown, 60000);
    updateCountdown();
  }
  document.querySelectorAll('.predict__info-lock-countdown').forEach(startCountdown);

  // custom horizontal scroll
  var scrollBar = document.querySelector(".table__scrollbar"),
    scrollBarThumb = document.querySelector(".table__scrollbar-thumb"),
    scrollElem = document.querySelector('.table__wrap-scroll'),
    scrollContainer = document.querySelector('.table__wrap');
  var scrollBarWidth = scrollContainer.clientWidth - 50,
    scrollBarThumbWidth;
  if (scrollElem.clientWidth <= scrollContainer.clientWidth) {
    scrollBar.style.display = "none";
  } else {
    scrollBar.style.display = "block";
    scrollBarThumbWidth = (scrollBarWidth * scrollContainer.clientWidth - 50) / scrollElem.scrollWidth;
    scrollBarThumb.style.width = "".concat(scrollBarThumbWidth, "px");
    scrollBar.style.width = "".concat(scrollBarWidth, "px");
  }
  var currentScrollDistance = 0;
  scrollContainer.addEventListener("scroll", function () {
    currentScrollDistance = scrollContainer.scrollLeft * 100 / scrollContainer.clientWidth;
    scrollBarThumb.style.left = "".concat(scrollBarThumbWidth / 100 * currentScrollDistance - 5, "px");
  });

  // // scroll anim
  //     function isInViewport(element, visibilityThreshold) {
  //         const rect = element.getBoundingClientRect(),
  //               windowHeight = window.innerHeight || document.documentElement.clientHeight,
  //               windowWidth = window.innerWidth || document.documentElement.clientWidth,
  //               visibleHeight = Math.min(rect.bottom, windowHeight) - Math.max(rect.top, 0),
  //               visibleWidth = Math.min(rect.right, windowWidth) - Math.max(rect.left, 0),
  //               elementHeight = rect.height,
  //               elementWidth = rect.width,
  //               visibleArea = visibleHeight * visibleWidth,
  //               totalArea = elementHeight * elementWidth,
  //               visiblePercentage = visibleArea / totalArea
  //         return visiblePercentage >= visibilityThreshold
  //     }
  //     function addClassOnVisibility(element, className, visibilityThreshold) {
  //         window.addEventListener('scroll', () => {
  //             if (isInViewport(element, visibilityThreshold)) {
  //                 element.classList.add(className)
  //             }
  //         });
  //         document.addEventListener("DOMContentLoaded", () => {
  //             if (isInViewport(element, visibilityThreshold)) {
  //                 element.classList.add(className)
  //             }
  //         })
  //     }

  document.querySelector(".dark-btn").addEventListener("click", function () {
    document.body.classList.toggle("dark");
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwic3RhZ2VUYWJzIiwicXVlcnlTZWxlY3RvckFsbCIsInN0YWdlV3JhcHMiLCJsb3NlQ2FyZHMiLCJsb3NlQ2FyZHNUZWFtcyIsIndpbkNhcmRzIiwid2luQ2FyZHNUZWFtcyIsInByZWRpY3RPdmVybGF5IiwicXVlcnlTZWxlY3RvciIsInByZWRpY3RQb3B1cHMiLCJwcmVkaWN0VGVhbXMiLCJwcmVkaWN0QnRucyIsInByZWRpY3RMaXN0IiwicHJlZGljdExpc3RJdGVtIiwiY3VycmVudENhcmQiLCJzZXRQb3B1cCIsIm92ZXJsYXkiLCJidG5zIiwicG9wdXBzIiwiYnRuV3JhcHMiLCJmb3JFYWNoIiwiYnRuIiwiaSIsImUiLCJ0YXJnZXRDbGljayIsInByZWRpY3RCdG4iLCJzdG9yYWdlRGF0YSIsInRhcmdldCIsInBhcmVudEVsZW1lbnQiLCJnZXRBdHRyaWJ1dGUiLCJyZW1vdmVBdHRyaWJ1dGUiLCJpbmRleCIsIndyYXAiLCJzaG93UG9wdXAiLCJwb3B1cCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsImJvZHkiLCJzdHlsZSIsIm92ZXJmbG93IiwiY2xvc2VCdG4iLCJvbmNlIiwic2V0UG9wdXBXaW5Mb3NlIiwic2V0VGVhbSIsInRlYW1zIiwiY2FyZHNUZXh0Iiwic3RhdHVzIiwiY2FyZHMiLCJpdGVtIiwicHVzaCIsImNhcmQiLCJrZXkiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiaW5uZXJIVE1MIiwiaW5uZXJUZXh0IiwidHJpbSIsInNldEF0dHJpYnV0ZSIsInRlYW0iLCJ0ZWFtTmFtZSIsInRleHRDb250ZW50Iiwic2V0SXRlbSIsImNhcmRzVGV4dExpc3RzIiwibGlzdCIsImxpc3RJbmRleCIsImNoaWxkTm9kZXMiLCJzdGFnZSIsInRlYW1UZXh0QmxvY2siLCJjb25zb2xlIiwibG9nIiwicmVtb3ZlVGVhbSIsInJlbW92ZUJ0bnMiLCJsaXN0U3RhdGUiLCJyZW1vdmVCdG4iLCJidG5QYXJlbnQiLCJkYXRhQnRuIiwicmVtb3ZlSXRlbSIsInRhYiIsInRhYkluZGV4Iiwic3RhZ2VJbmRleCIsImNvbnRhaW5zIiwic3RhcnRDb3VudGRvd24iLCJlbGVtZW50IiwidGFyZ2V0RGF0ZSIsIkRhdGUiLCJ1cGRhdGVDb3VudGRvd24iLCJub3ciLCJkaWZmZXJlbmNlIiwiY2xlYXJJbnRlcnZhbCIsImNvdW50ZG93bkludGVydmFsIiwiZGF5cyIsIk1hdGgiLCJmbG9vciIsImhvdXJzIiwibWludXRlcyIsInNldEludGVydmFsIiwic2Nyb2xsQmFyIiwic2Nyb2xsQmFyVGh1bWIiLCJzY3JvbGxFbGVtIiwic2Nyb2xsQ29udGFpbmVyIiwic2Nyb2xsQmFyV2lkdGgiLCJjbGllbnRXaWR0aCIsInNjcm9sbEJhclRodW1iV2lkdGgiLCJkaXNwbGF5Iiwic2Nyb2xsV2lkdGgiLCJ3aWR0aCIsImN1cnJlbnRTY3JvbGxEaXN0YW5jZSIsInNjcm9sbExlZnQiLCJsZWZ0IiwidG9nZ2xlIl0sIm1hcHBpbmdzIjoiOztBQUFBQSxRQUFRLENBQUNDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLFlBQUk7RUFDOUMsSUFBTUMsU0FBUyxHQUFHRixRQUFRLENBQUNHLGdCQUFnQixDQUFDLHFCQUFxQixDQUFDO0lBQzVEQyxVQUFVLEdBQUdKLFFBQVEsQ0FBQ0csZ0JBQWdCLENBQUMsaUJBQWlCLENBQUM7SUFDekRFLFNBQVMsR0FBR0wsUUFBUSxDQUFDRyxnQkFBZ0IsQ0FBQyxxQkFBcUIsQ0FBQztJQUM1REcsY0FBYyxHQUFHTixRQUFRLENBQUNHLGdCQUFnQixDQUFDLHFCQUFxQixDQUFDO0lBQ2pFSSxRQUFRLEdBQUdQLFFBQVEsQ0FBQ0csZ0JBQWdCLENBQUMsb0JBQW9CLENBQUM7SUFDMURLLGFBQWEsR0FBR1IsUUFBUSxDQUFDRyxnQkFBZ0IsQ0FBQyxvQkFBb0IsQ0FBQztJQUMvRE0sY0FBYyxHQUFHVCxRQUFRLENBQUNVLGFBQWEsQ0FBQyxtQkFBbUIsQ0FB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LE9BQUk7RUFDakQ7RUFFQSxJQUFJTSxxQkFBcUIsR0FBRyxDQUFDO0VBRTdCUCxlQUFlLENBQUNyRyxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsWUFBTTtJQUM3QzRHLHFCQUFxQixHQUFJUCxlQUFlLENBQUNRLFVBQVUsR0FBRyxHQUFHLEdBQUlSLGVBQWUsQ0FBQ0UsV0FBVztJQUN4RkosY0FBYyxDQUFDM0QsS0FBSyxDQUFDc0UsSUFBSSxhQUFPTixtQkFBbUIsR0FBRyxHQUFHLEdBQUlJLHFCQUFxQixHQUFHLENBQUMsT0FBSTtFQUM5RixDQUFDLENBQUM7O0VBRU47RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7RUFFSTdHLFFBQVEsQ0FBQ1UsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDVCxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsWUFBSztJQUMvREQsUUFBUSxDQUFDd0MsSUFBSSxDQUFDSCxTQUFTLENBQUMyRSxNQUFNLENBQUMsTUFBTSxDQUFDO0VBQzFDLENBQUMsQ0FBQztBQUVOLENBQUMsQ0FBQyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCk9PntcbiAgICBjb25zdCBzdGFnZVRhYnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnByZWRpY3RfX3RhYnMtaXRlbVwiKSxcbiAgICAgICAgICBzdGFnZVdyYXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wcmVkaWN0X19zdGFnZVwiKSxcbiAgICAgICAgICBsb3NlQ2FyZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnByZWRpY3RfX2xvc2UtY2FyZFwiKSxcbiAgICAgICAgICBsb3NlQ2FyZHNUZWFtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucHJlZGljdF9fbG9zZS10ZWFtXCIpLFxuICAgICAgICAgIHdpbkNhcmRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wcmVkaWN0X193aW4tY2FyZFwiKSxcbiAgICAgICAgICB3aW5DYXJkc1RlYW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wcmVkaWN0X193aW4tdGVhbVwiKSxcbiAgICAgICAgICBwcmVkaWN0T3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJlZGljdF9fb3ZlcmxheVwiKSxcbiAgICAgICAgICBwcmVkaWN0UG9wdXBzID0gcHJlZGljdE92ZXJsYXkucXVlcnlTZWxlY3RvckFsbChcIi5wcmVkaWN0X190ZWFtc1wiKSxcbiAgICAgICAgICBwcmVkaWN0VGVhbXMgPSBwcmVkaWN0T3ZlcmxheS5xdWVyeVNlbGVjdG9yQWxsKFwiLnByZWRpY3RfX3RlYW1zLWl0ZW1cIiksXG4gICAgICAgICAgcHJlZGljdEJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhcmRzLWJ0blwiKSxcbiAgICAgICAgICBwcmVkaWN0TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucHJlZGljdF9fbGlzdFwiKSxcbiAgICAgICAgICBwcmVkaWN0TGlzdEl0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnByZWRpY3RfX2xpc3QtaXRlbVwiKVxuXG4gICAgLy8gY29uc29sZS5sb2cocHJlZGljdEJ0bnMpXG5cbiAgICBsZXQgY3VycmVudENhcmQ7XG4gICAgLy8gbGV0IHNldFN0YXR1cztcblxuXG4gICAgZnVuY3Rpb24gc2V0UG9wdXAob3ZlcmxheSwgYnRucywgcG9wdXBzLCAgYnRuV3JhcHMpIHtcbiAgICAgICAgYnRucy5mb3JFYWNoKChidG4sIGkpID0+IHtcbiAgICAgICAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgcHJlZGljdEJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhcmRzLWJ0blwiKSxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Q2xpY2sgPSB0cnVlXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocHJlZGljdEJ0bnMpXG4gICAgICAgICAgICAgICAgcHJlZGljdEJ0bnMuZm9yRWFjaChwcmVkaWN0QnRuID0+e1xuICAgICAgICAgICAgICAgICAgICBsZXQgc3RvcmFnZURhdGEgPSBlLnRhcmdldC5wYXJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZShcImRhdGEtc3RvcmFnZVwiKVxuICAgICAgICAgICAgICAgICAgICBpZihwcmVkaWN0QnRuID09PSBlLnRhcmdldCAmJiBzdG9yYWdlRGF0YSAhPT0gbnVsbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRDbGljayA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnRhcmdldC5wYXJlbnRFbGVtZW50LnJlbW92ZUF0dHJpYnV0ZShcImRhdGEtc3RvcmFnZVwiKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXRDbGlja1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgaWYodGFyZ2V0Q2xpY2spe1xuICAgICAgICAgICAgICAgICAgICBsZXQgaW5kZXg7XG4gICAgICAgICAgICAgICAgICAgIGJ0bldyYXBzLmZvckVhY2goKHdyYXAsIGkpID0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYnRuLnBhcmVudEVsZW1lbnQgPT09IHdyYXApe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmRleCA9IGlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgc2hvd1BvcHVwKHBvcHVwcywgb3ZlcmxheSwgaW5kZXgpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50Q2FyZCA9IGJ0blxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzZXRQb3B1cChwcmVkaWN0T3ZlcmxheSwgcHJlZGljdExpc3RJdGVtLCBwcmVkaWN0UG9wdXBzLCBwcmVkaWN0TGlzdClcblxuXG4gICAgZnVuY3Rpb24gc2hvd1BvcHVwKHBvcHVwcywgb3ZlcmxheSwgaW5kZXgpe1xuICAgICAgICBwb3B1cHMuZm9yRWFjaChwb3B1cCA9PiBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwiX2FjdGl2ZVwiKSk7XG4gICAgICAgIG92ZXJsYXkuY2xhc3NMaXN0LmFkZChcIl9hY3RpdmVcIik7XG4gICAgICAgIHBvcHVwc1tpbmRleF0uY2xhc3NMaXN0LmFkZChcIl9hY3RpdmVcIik7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSBcImhpZGRlblwiXG4gICAgICAgIGNvbnN0IGNsb3NlQnRuID0gcG9wdXBzW2luZGV4XS5xdWVyeVNlbGVjdG9yKFwiLnByZWRpY3RfX3RlYW1zLWNsb3NlXCIpO1xuICAgICAgICBjbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICAgICAgb3ZlcmxheS5jbGFzc0xpc3QucmVtb3ZlKFwiX2FjdGl2ZVwiKTtcbiAgICAgICAgICAgIHBvcHVwc1tpbmRleF0uY2xhc3NMaXN0LnJlbW92ZShcIl9hY3RpdmVcIik7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gXCJhdXRvXCJcbiAgICAgICAgfSwgeyBvbmNlOiB0cnVlIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldFBvcHVwV2luTG9zZShvdmVybGF5LCBidG5zLCBwb3B1cHMsIHByZWRpY3RCdG5zKSB7XG4gICAgICAgIGJ0bnMuZm9yRWFjaCgoYnRuLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCB0YXJnZXRDbGljayA9IHRydWVcbiAgICAgICAgICAgICAgICBwcmVkaWN0QnRucy5mb3JFYWNoKHByZWRpY3RCdG4gPT57XG4gICAgICAgICAgICAgICAgICAgIGlmKHByZWRpY3RCdG4uY2xhc3NMaXN0ID09PSBlLnRhcmdldC5jbGFzc0xpc3Qpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Q2xpY2sgPSBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXRDbGlja1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgaWYodGFyZ2V0Q2xpY2spe1xuICAgICAgICAgICAgICAgICAgICBzaG93UG9wdXAocG9wdXBzLCBvdmVybGF5LCBpbmRleClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRDYXJkID0gYnRuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBzZXRQb3B1cFdpbkxvc2UocHJlZGljdE92ZXJsYXksIHdpbkNhcmRzLCBwcmVkaWN0UG9wdXBzLCBwcmVkaWN0QnRucylcbiAgICBzZXRQb3B1cFdpbkxvc2UocHJlZGljdE92ZXJsYXksIGxvc2VDYXJkcywgcHJlZGljdFBvcHVwcywgcHJlZGljdEJ0bnMpXG5cblxuXG4gICAgZnVuY3Rpb24gc2V0VGVhbSh0ZWFtcywgY2FyZHNUZXh0LCBvdmVybGF5LCBwb3B1cHMsIHN0YXR1cykge1xuICAgICAgICBpZihzdGF0dXMpe1xuICAgICAgICAgICAgbGV0IGNhcmRzID0gW107XG4gICAgICAgICAgICBjYXJkc1RleHQuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgICAgICBjYXJkcy5wdXNoKGl0ZW0ucGFyZW50RWxlbWVudC5jbGFzc0xpc3RbMV0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjYXJkcy5mb3JFYWNoKChjYXJkLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IGtleSA9IGBzZWxlY3RlZFRlYW0tJHtjYXJkfS0ke3N0YXR1c31gO1xuICAgICAgICAgICAgICAgIGlmKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkpe1xuICAgICAgICAgICAgICAgICAgICBjYXJkc1RleHRbaV0uaW5uZXJIVE1MID0gYNCa0L7QvNCw0L3QtNCwIDxicj4gJHtsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpfWA7XG4gICAgICAgICAgICAgICAgICAgIGNhcmRzVGV4dFtpXS5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIl9zZWxlY3RcIilcbiAgICAgICAgICAgICAgICAgICAgaWYoY2FyZHNUZXh0W2ldLmlubmVyVGV4dC50cmltKCkgIT09ICcnKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhcmRzVGV4dFtpXS5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcIl9zZWxlY3RcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhcmRzVGV4dFtpXS5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXN0b3JhZ2UnLCBrZXkpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGVhbXMuZm9yRWFjaCgodGVhbSkgPT4ge1xuICAgICAgICAgICAgICAgIHRlYW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IHRlYW1QYXJlbnQgPSB0ZWFtLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGVhbU5hbWUgPSB0ZWFtLnF1ZXJ5U2VsZWN0b3IoXCIudGVhbS1uYW1lXCIpLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgICAgICBjYXJkcy5mb3JFYWNoKChjYXJkLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENhcmQgPT09IGNhcmRzVGV4dFtpXS5wYXJlbnRFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGtleSA9IGBzZWxlY3RlZFRlYW0tJHtjYXJkfS0ke3N0YXR1c31gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDYXJkLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcIl9zZWxlY3RcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2FyZC5wYXJlbnRFbGVtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1zdG9yYWdlJywga2V5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgYCR7dGVhbU5hbWV9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FyZHNUZXh0W2ldLmlubmVySFRNTCA9IGDQmtC+0LzQsNC90LTQsCA8YnI+ICR7dGVhbU5hbWV9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoXCJfYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVwcy5mb3JFYWNoKHBvcHVwID0+IHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJfYWN0aXZlXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gXCJhdXRvXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgICAgbGV0IGNhcmRzVGV4dExpc3RzID0gW11cbiAgICAgICAgICAgIGNhcmRzVGV4dC5mb3JFYWNoKGl0ZW0gPT57XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhcmRzVGV4dExpc3RzLnB1c2goaXRlbSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBjYXJkc1RleHRMaXN0cy5mb3JFYWNoKChsaXN0LCBsaXN0SW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBsaXN0LmNoaWxkTm9kZXMuZm9yRWFjaCgoaXRlbSwgaSkgPT57XG4gICAgICAgICAgICAgICAgICAgIGxldCBzdGFnZSA9IGxpc3QuZ2V0QXR0cmlidXRlKFwiZGF0YS1zdGFnZVwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9IGBzZWxlY3RlZFRlYW0tJHtzdGFnZX0tY2FyZCR7KytpfWAsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZWFtVGV4dEJsb2NrID0gaXRlbS5xdWVyeVNlbGVjdG9yKGAuJHtpdGVtLmNsYXNzTGlzdFswXX0tdGVhbWApXG4gICAgICAgICAgICAgICAgICAgIHRlYW1zLmZvckVhY2goKHRlYW0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlYW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXRlbSA9PT0gY3VycmVudENhcmQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ZWFtTmFtZSA9IHRlYW0ucXVlcnlTZWxlY3RvcihcIi50ZWFtLW5hbWVcIikudGV4dENvbnRlbnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENhcmQuY2xhc3NMaXN0LmFkZChcIl9zZWxlY3RcIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENhcmQuc2V0QXR0cmlidXRlKCdkYXRhLXN0b3JhZ2UnLCBrZXkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgYCR7dGVhbU5hbWV9YCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGl0ZW0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlYW1UZXh0QmxvY2suaW5uZXJIVE1MID0gYNCa0L7QvNCw0L3QtNCwIDxicj4gJHt0ZWFtTmFtZX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoXCJfYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3B1cHMuZm9yRWFjaChwb3B1cCA9PiBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwiX2FjdGl2ZVwiKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSBcImF1dG9cIlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBpZihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwia2V5XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZWFtVGV4dEJsb2NrLmlubmVySFRNTCA9IGDQmtC+0LzQsNC90LTQsCA8YnI+ICR7bG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KX1gO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVhbVRleHRCbG9jay5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIl9zZWxlY3RcIilcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRlYW1UZXh0QmxvY2suaW5uZXJUZXh0LnRyaW0oKSAhPT0gJycpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlYW1UZXh0QmxvY2sucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiX3NlbGVjdFwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlYW1UZXh0QmxvY2sucGFyZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3RvcmFnZScsIGtleSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG5cblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH1cbiAgICBzZXRUZWFtKHByZWRpY3RUZWFtcywgd2luQ2FyZHNUZWFtcywgcHJlZGljdE92ZXJsYXksIHByZWRpY3RQb3B1cHMsIFwid2luXCIpO1xuICAgIHNldFRlYW0ocHJlZGljdFRlYW1zLCBsb3NlQ2FyZHNUZWFtcywgcHJlZGljdE92ZXJsYXksIHByZWRpY3RQb3B1cHMsIFwibG9zZVwiKTtcbiAgICBzZXRUZWFtKHByZWRpY3RUZWFtcywgcHJlZGljdExpc3QsIHByZWRpY3RPdmVybGF5LCBwcmVkaWN0UG9wdXBzLCBudWxsKTtcblxuICAgIGZ1bmN0aW9uIHJlbW92ZVRlYW0ocmVtb3ZlQnRucywgbGlzdFN0YXRlKXtcbiAgICAgICAgcmVtb3ZlQnRucy5mb3JFYWNoKHJlbW92ZUJ0biA9PntcbiAgICAgICAgICAgIHJlbW92ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT57XG4gICAgICAgICAgICAgICAgbGV0IGJ0blBhcmVudCA9ICByZW1vdmVCdG4ucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICBkYXRhQnRuID0gYnRuUGFyZW50LmdldEF0dHJpYnV0ZShcImRhdGEtc3RvcmFnZVwiKVxuXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZGF0YUJ0bilcbiAgICAgICAgICAgICAgICBpZighZGF0YUJ0bil7XG4gICAgICAgICAgICAgICAgICAgIGJ0blBhcmVudCA9IHJlbW92ZUJ0bi5wYXJlbnRFbGVtZW50XG4gICAgICAgICAgICAgICAgICAgIGRhdGFCdG4gPSBidG5QYXJlbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS1zdG9yYWdlXCIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGRhdGFCdG4pXG4gICAgICAgICAgICAgICAgYnRuUGFyZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJfc2VsZWN0XCIpXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLy8gcmVtb3ZlVGVhbShwcmVkaWN0QnRucylcbiAgICByZW1vdmVUZWFtKHByZWRpY3RCdG5zKVxuXG4gICAgc3RhZ2VUYWJzLmZvckVhY2goKHRhYiwgdGFiSW5kZXgpID0+e1xuICAgICAgICB0YWIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChlKSA9PntcbiAgICAgICAgICAgIHN0YWdlVGFicy5mb3JFYWNoKCh0YWIsIGkpID0+e1xuICAgICAgICAgICAgICB0YWIuY2xhc3NMaXN0LnJlbW92ZShcIl9hY3RpdmVcIilcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBzdGFnZVdyYXBzLmZvckVhY2goKGl0ZW0sIHN0YWdlSW5kZXgpID0+e1xuICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShcIl9hY3RpdmVcIilcbiAgICAgICAgICAgICAgICBpZih0YWJJbmRleCA9PT0gc3RhZ2VJbmRleCl7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZChcIl9hY3RpdmVcIilcbiAgICAgICAgICAgICAgICAgICAgaWYoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJzdGFnZTNcIikpe1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3N0YWdlMycpXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3N0YWdlMycpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LmFkZChcIl9hY3RpdmVcIilcbiAgICAgICAgfSlcbiAgICB9KVxuXG4vLyBjb3VudGRvd24gdGltZXJcbiAgICBmdW5jdGlvbiBzdGFydENvdW50ZG93bihlbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IHRhcmdldERhdGUgPSBuZXcgRGF0ZShlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS10YXJnZXQtZGF0ZScpKVxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVDb3VudGRvd24oKSB7XG4gICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgZGlmZmVyZW5jZSA9IHRhcmdldERhdGUgLSBub3dcbiAgICAgICAgICAgIGlmIChkaWZmZXJlbmNlIDw9IDApIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcmVkaWN0X19pbmZvLWxvY2stY291bnRkb3duJykudGV4dENvbnRlbnQgPSBcInRpbWUgb3ZlclwiXG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChjb3VudGRvd25JbnRlcnZhbClcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGRheXMgPSBNYXRoLmZsb29yKGRpZmZlcmVuY2UgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpLFxuICAgICAgICAgICAgICAgICAgaG91cnMgPSBNYXRoLmZsb29yKChkaWZmZXJlbmNlICUgKDEwMDAgKiA2MCAqIDYwICogMjQpKSAvICgxMDAwICogNjAgKiA2MCkpLFxuICAgICAgICAgICAgICAgICAgbWludXRlcyA9IE1hdGguZmxvb3IoKGRpZmZlcmVuY2UgJSAoMTAwMCAqIDYwICogNjApKSAvICgxMDAwICogNjApKVxuICAgICAgICAgICAgZWxlbWVudC5xdWVyeVNlbGVjdG9yKCcucHJlZGljdF9faW5mby1sb2NrLWRheXMnKS50ZXh0Q29udGVudCA9IGRheXNcbiAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnByZWRpY3RfX2luZm8tbG9jay1ob3VycycpLnRleHRDb250ZW50ID0gaG91cnNcbiAgICAgICAgICAgIGVsZW1lbnQucXVlcnlTZWxlY3RvcignLnByZWRpY3RfX2luZm8tbG9jay1taW51dGVzJykudGV4dENvbnRlbnQgPSBtaW51dGVzXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY291bnRkb3duSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh1cGRhdGVDb3VudGRvd24sIDYwMDAwKVxuICAgICAgICB1cGRhdGVDb3VudGRvd24oKVxuICAgIH1cbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucHJlZGljdF9faW5mby1sb2NrLWNvdW50ZG93bicpLmZvckVhY2goc3RhcnRDb3VudGRvd24pXG5cbiAgICAvLyBjdXN0b20gaG9yaXpvbnRhbCBzY3JvbGxcbiAgICBjb25zdCBzY3JvbGxCYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRhYmxlX19zY3JvbGxiYXJcIiksXG4gICAgICAgICAgc2Nyb2xsQmFyVGh1bWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRhYmxlX19zY3JvbGxiYXItdGh1bWJcIiksXG4gICAgICAgICAgc2Nyb2xsRWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50YWJsZV9fd3JhcC1zY3JvbGwnKSxcbiAgICAgICAgICBzY3JvbGxDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGFibGVfX3dyYXAnKVxuXG4gICAgbGV0IHNjcm9sbEJhcldpZHRoID0gc2Nyb2xsQ29udGFpbmVyLmNsaWVudFdpZHRoIC0gNTAsXG4gICAgICAgIHNjcm9sbEJhclRodW1iV2lkdGg7XG5cbiAgICBpZiAoc2Nyb2xsRWxlbS5jbGllbnRXaWR0aCA8PSBzY3JvbGxDb250YWluZXIuY2xpZW50V2lkdGgpIHtcbiAgICAgICAgc2Nyb2xsQmFyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIlxuICAgIH0gZWxzZSB7XG4gICAgICAgIHNjcm9sbEJhci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiXG4gICAgICAgIHNjcm9sbEJhclRodW1iV2lkdGggPSAoc2Nyb2xsQmFyV2lkdGggKiBzY3JvbGxDb250YWluZXIuY2xpZW50V2lkdGggLSA1MCkgLyBzY3JvbGxFbGVtLnNjcm9sbFdpZHRoXG4gICAgICAgIHNjcm9sbEJhclRodW1iLnN0eWxlLndpZHRoID0gYCR7c2Nyb2xsQmFyVGh1bWJXaWR0aH1weGBcbiAgICAgICAgc2Nyb2xsQmFyLnN0eWxlLndpZHRoID0gYCR7c2Nyb2xsQmFyV2lkdGh9cHhgXG4gICAgfVxuXG4gICAgbGV0IGN1cnJlbnRTY3JvbGxEaXN0YW5jZSA9IDBcblxuICAgIHNjcm9sbENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsICgpID0+IHtcbiAgICAgICAgY3VycmVudFNjcm9sbERpc3RhbmNlID0gKHNjcm9sbENvbnRhaW5lci5zY3JvbGxMZWZ0ICogMTAwKSAvIHNjcm9sbENvbnRhaW5lci5jbGllbnRXaWR0aFxuICAgICAgICBzY3JvbGxCYXJUaHVtYi5zdHlsZS5sZWZ0ID0gYCR7KHNjcm9sbEJhclRodW1iV2lkdGggLyAxMDApICogY3VycmVudFNjcm9sbERpc3RhbmNlIC0gNX1weGBcbiAgICB9KTtcblxuLy8gLy8gc2Nyb2xsIGFuaW1cbi8vICAgICBmdW5jdGlvbiBpc0luVmlld3BvcnQoZWxlbWVudCwgdmlzaWJpbGl0eVRocmVzaG9sZCkge1xuLy8gICAgICAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbi8vICAgICAgICAgICAgICAgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsXG4vLyAgICAgICAgICAgICAgIHdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoLFxuLy8gICAgICAgICAgICAgICB2aXNpYmxlSGVpZ2h0ID0gTWF0aC5taW4ocmVjdC5ib3R0b20sIHdpbmRvd0hlaWdodCkgLSBNYXRoLm1heChyZWN0LnRvcCwgMCksXG4vLyAgICAgICAgICAgICAgIHZpc2libGVXaWR0aCA9IE1hdGgubWluKHJlY3QucmlnaHQsIHdpbmRvd1dpZHRoKSAtIE1hdGgubWF4KHJlY3QubGVmdCwgMCksXG4vLyAgICAgICAgICAgICAgIGVsZW1lbnRIZWlnaHQgPSByZWN0LmhlaWdodCxcbi8vICAgICAgICAgICAgICAgZWxlbWVudFdpZHRoID0gcmVjdC53aWR0aCxcbi8vICAgICAgICAgICAgICAgdmlzaWJsZUFyZWEgPSB2aXNpYmxlSGVpZ2h0ICogdmlzaWJsZVdpZHRoLFxuLy8gICAgICAgICAgICAgICB0b3RhbEFyZWEgPSBlbGVtZW50SGVpZ2h0ICogZWxlbWVudFdpZHRoLFxuLy8gICAgICAgICAgICAgICB2aXNpYmxlUGVyY2VudGFnZSA9IHZpc2libGVBcmVhIC8gdG90YWxBcmVhXG4vLyAgICAgICAgIHJldHVybiB2aXNpYmxlUGVyY2VudGFnZSA+PSB2aXNpYmlsaXR5VGhyZXNob2xkXG4vLyAgICAgfVxuLy8gICAgIGZ1bmN0aW9uIGFkZENsYXNzT25WaXNpYmlsaXR5KGVsZW1lbnQsIGNsYXNzTmFtZSwgdmlzaWJpbGl0eVRocmVzaG9sZCkge1xuLy8gICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgKCkgPT4ge1xuLy8gICAgICAgICAgICAgaWYgKGlzSW5WaWV3cG9ydChlbGVtZW50LCB2aXNpYmlsaXR5VGhyZXNob2xkKSkge1xuLy8gICAgICAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpXG4vLyAgICAgICAgICAgICB9XG4vLyAgICAgICAgIH0pO1xuLy8gICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4vLyAgICAgICAgICAgICBpZiAoaXNJblZpZXdwb3J0KGVsZW1lbnQsIHZpc2liaWxpdHlUaHJlc2hvbGQpKSB7XG4vLyAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSlcbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgfSlcbi8vICAgICB9XG5cbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmRhcmstYnRuXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PntcbiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QudG9nZ2xlKFwiZGFya1wiKVxuICAgIH0pXG5cbn0pXG5cblxuXG4iXX0=
